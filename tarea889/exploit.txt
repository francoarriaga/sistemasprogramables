import usocket
import network
import utime

def connect_to_wifi(ssid, password):
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    wlan.connect(ssid, password)
    print("Conectando a la red Wi-Fi...")
    for _ in range(10):  # Espera hasta 10 segundos
        if wlan.isconnected():
            print("Conectado a la red Wi-Fi")
            print(f"Dirección IP: {wlan.ifconfig()[0]}")
            return True
        utime.sleep(1)
    print("Error: No se pudo conectar a la red Wi-Fi")
    return False

def ftp_terminal(target_ip, ftp_port=21, username='msfadmin', password='msfadmin'):
    try:
        print("Conectando al servidor FTP...")
        ftp_socket = usocket.socket(usocket.AF_INET, usocket.SOCK_STREAM)
        ftp_socket.connect((target_ip, ftp_port))
        banner = ftp_socket.recv(1024)
        print(f"Banner: {banner.decode('utf-8')}")

        # Autenticación
        ftp_socket.send(f"USER {username}\r\n".encode('utf-8'))
        print(ftp_socket.recv(1024).decode('utf-8'))
        ftp_socket.send(f"PASS {password}\r\n".encode('utf-8'))
        print(ftp_socket.recv(1024).decode('utf-8'))

        # Terminal interactiva
        print("Bienvenido a la terminal FTP interactiva. Escribe 'exit' para salir.")
        while True:
            command = input("ftp> ")
            if command.lower() == 'exit':
                print("Saliendo de la terminal FTP...")
                break
            if not command.strip():
                continue
            ftp_socket.send(f"{command}\r\n".encode('utf-8'))
            response = ftp_socket.recv(1024).decode('utf-8')
            print(response)

        ftp_socket.close()
        print("Conexión cerrada.")

    except Exception as e:
        print(f"Error: {e}")

def main():
    ssid = "IZZI-58CF"
    wifi_password = "9CC8FC7058CF"

    if connect_to_wifi(ssid, wifi_password):
        target_ip = '192.168.0.13'  # Cambia por la IP de tu servidor FTP
        ftp_port = 21
        username = 'msfadmin'
        password = 'msfadmin'

        ftp_terminal(target_ip, ftp_port, username, password)
    else:
        print("No se pudo establecer conexión Wi-Fi.")

if _name_ == '_main_':
    main()
